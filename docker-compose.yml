services:
  # -----------------------------------------
  # PicoClaw Agent (one-shot query)
  #   docker compose --profile agent run --rm picoclaw-agent -m "Hello"
  # -----------------------------------------
  picoclaw-agent:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: picoclaw-agent
    profiles:
      - agent
    volumes:
      - picoclaw-config:/home/picoclaw/.picoclaw
      - picoclaw-workspace:/home/picoclaw/.picoclaw/workspace
    entrypoint: ["picoclaw", "agent"]
    stdin_open: true
    tty: true

  # -----------------------------------------
  # PicoClaw Gateway (long-running HTTP API)
  #   docker compose --profile gateway up picoclaw-gateway
  # -----------------------------------------
  picoclaw-gateway:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: picoclaw-gateway
    restart: unless-stopped
    profiles:
      - gateway
    ports:
      - "18790:18790"
    volumes:
      # Config directory - writable so admin endpoint can update config.json
      - picoclaw-config:/home/picoclaw/.picoclaw
      # Persistent workspace (sessions, memory, logs)
      - picoclaw-workspace:/home/picoclaw/.picoclaw/workspace
    environment:
      # LLM API keys - set in .env or pass via shell
      GROQ_API_KEY: ${GROQ_API_KEY:-}
      GEMINI_API_KEY: ${GEMINI_API_KEY:-}
      KIMI_API_KEY: ${KIMI_API_KEY:-}
      DEEPSEEK_API_KEY: ${DEEPSEEK_API_KEY:-}
    command: ["gateway"]

volumes:
  picoclaw-config:
  picoclaw-workspace:
